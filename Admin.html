<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Furry Shop Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background: #fafafa; margin:0; padding:20px; }
    h2 { color: #333; }
    .hidden { display: none; }
    .tab { margin-top:20px; }
    button { padding: 6px 12px; margin: 4px; cursor: pointer; }
    input, textarea { width:100%; margin:4px 0; padding:8px; }
    ul { list-style: none; padding:0; }
    li { background:#fff; padding:10px; margin-bottom:6px; border:1px solid #ddd; border-radius:6px; }
  </style>
</head>
<body>

  <h2>üêæ Furry Shop Admin Panel</h2>

  <!-- Login Section -->
  <div id="loginSection">
    <p>Enter your GitHub Personal Access Token:</p>
    <input type="password" id="githubToken" placeholder="Paste token here">
    <button onclick="saveToken()">Login</button>
  </div>

  <!-- Admin Section -->
  <div id="adminSection" class="hidden">
    <button onclick="showTab('listings')">Listings</button>
    <button onclick="showTab('reviews')">Reviews</button>
    <button onclick="showTab('sellers')">Sellers</button>
    <button onclick="showTab('settings')">Settings</button>

    <!-- Listings Tab -->
    <div id="listings" class="tab hidden">
      <h3>Manage Listings</h3>
      <form id="listingForm">
        <input type="hidden" id="listingId">
        <input type="text" id="title" placeholder="Title">
        <textarea id="description" placeholder="Description"></textarea>
        <input type="text" id="price" placeholder="Price">
        <input type="text" id="images" placeholder="Image URLs (comma separated)">
        <input type="text" id="category" placeholder="Category">
        <button type="button" onclick="saveListing()">Save Listing</button>
      </form>
      <h4>Current Listings</h4>
      <ul id="listingList"></ul>
    </div>

    <!-- Reviews Tab -->
    <div id="reviews" class="tab hidden">
      <h3>Manage Reviews</h3>
      <p>(Coming next‚Ä¶)</p>
    </div>

    <!-- Sellers Tab -->
    <div id="sellers" class="tab hidden">
      <h3>Manage Sellers</h3>
      <p>(Coming next‚Ä¶)</p>
    </div>

    <!-- Settings Tab -->
    <div id="settings" class="tab hidden">
      <h3>Settings</h3>
      <button onclick="logout()">Logout</button>
    </div>
  </div>

  <script>
    // üîß CHANGE THESE
    const repoOwner = "kaelen-frostclaw";   // e.g. odafex
    const repoName  = "shop";         // e.g. furry-market
    const listingsPath = "listings.json";
    let sha = "";
    let listings = [];

    // Show correct section
    function showTab(id) {
      document.querySelectorAll('.tab').forEach(el => el.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
    }

    function saveToken() {
      let token = document.getElementById("githubToken").value;
      if (!token) { alert("Enter token"); return; }
      localStorage.setItem("githubToken", token);
      document.getElementById("loginSection").classList.add("hidden");
      document.getElementById("adminSection").classList.remove("hidden");
      loadListings();
    }

    function logout() {
      localStorage.removeItem("githubToken");
      location.reload();
    }

    async function loadListings() {
      let token = localStorage.getItem("githubToken");
      let apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${listingsPath}`;
      let response = await fetch(apiUrl, { headers: { Authorization: `token ${token}` } });
      let fileData = await response.json();
      if (fileData.content) {
        listings = JSON.parse(atob(fileData.content));
        sha = fileData.sha;
        renderListings();
      }
    }

    function renderListings() {
      let listEl = document.getElementById("listingList");
      listEl.innerHTML = "";
      listings.forEach(l => {
        let li = document.createElement("li");
        li.innerHTML = `
          <strong>${l.title}</strong> - ${l.price} <br>
          <button onclick="editListing(${l.id})">Edit</button>
          <button onclick="deleteListing(${l.id})">Delete</button>
        `;
        listEl.appendChild(li);
      });
    }

    async function saveListing() {
      let token = localStorage.getItem("githubToken");
      let id = document.getElementById("listingId").value || Date.now();
      let newListing = {
        id,
        title: document.getElementById("title").value,
        description: document.getElementById("description").value,
        price: document.getElementById("price").value,
        images: document.getElementById("images").value.split(",").map(s => s.trim()),
        category: document.getElementById("category").value
      };

      let existingIndex = listings.findIndex(l => l.id == id);
      if (existingIndex >= 0) listings[existingIndex] = newListing;
      else listings.push(newListing);

      await commitListings(token);
      resetForm();
    }

    function editListing(id) {
      let l = listings.find(x => x.id == id);
      document.getElementById("listingId").value = l.id;
      document.getElementById("title").value = l.title;
      document.getElementById("description").value = l.description;
      document.getElementById("price").value = l.price;
      document.getElementById("images").value = l.images.join(", ");
      document.getElementById("category").value = l.category;
    }

    async function deleteListing(id) {
      let token = localStorage.getItem("githubToken");
      listings = listings.filter(l => l.id != id);
      await commitListings(token);
    }

    async function commitListings(token) {
      let apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${listingsPath}`;
      let updatedContent = btoa(JSON.stringify(listings, null, 2));
      await fetch(apiUrl, {
        method: "PUT",
        headers: {
          Authorization: `token ${token}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          message: "Update listings",
          content: updatedContent,
          sha: sha
        })
      });
      alert("Listings updated!");
      await loadListings();
    }

    function resetForm() {
      document.getElementById("listingForm").reset();
      document.getElementById("listingId").value = "";
    }

    // Auto-login if token already saved
    if (localStorage.getItem("githubToken")) {
      document.getElementById("loginSection").classList.add("hidden");
      document.getElementById("adminSection").classList.remove("hidden");
      loadListings();
    }
  </script>

</body>
</html>
